# ะกะตัะธ ะฒ Linux

## Part 1. ะะฝััััะผะตะฝั **ipcalc**

`-` ะัะฐะบ, ะฝะฐัะฝัะผ ะฝะฐัะต ะฟะพะณััะถะตะฝะธะต ะฒ ัะดะธะฒะธัะตะปัะฝัะน ะผะธั ัะตัะตะน ัะพ ะทะฝะฐะบะพะผััะฒะฐ ั IP ะฐะดัะตัะฐะผะธ. ะ ะธัะฟะพะปัะทะพะฒะฐัั ะดะปั ััะพะณะพ ะผั ะฑัะดะตะผ ะธะฝััััะผะตะฝั **ipcalc**.

`@ws1:$ sudo apt install ipcalc`

##### ะะพะดะฝััั ะฒะธัััะฐะปัะฝัั ะผะฐัะธะฝั (ะดะฐะปะตะต -- ws1)

`@ws1:$ sudo hostnamectl set-hostname ws1`

#### 1.1. ะกะตัะธ ะธ ะผะฐัะบะธ

##### 1) ะะดัะตั ัะตัะธ `192.167.38.54/13`

192.160.0.0  \
->

```bash
ะััะพะดะฝัะน IP ะฐะดัะตั (source ip)
192.167.38.54
11000000.10100111.00100110.00110110
ะััะพะดะฝะฐั ะผะฐัะบะฐ (mask)
255.248.0.0 (/13)
11111111.11111 000.00000000.00000000
ะะพะปะธัะตััะฒะพ ะฐะดัะตัะพะฒ:
2^(32 - 13 =19 bytes) = 524288 )
524286 + 2 ะฐะดัะตัะฐ (network ะธ broadcast)
ะะฑัะฐัะฝะฐั ะผะฐัะบะฐ (wildcard mask)
0.7.255.255
00000000.00000111.11111111.11111111
ะะดัะตั ัะตัะธ (network) 
Ip & Mask = 
192.160.0.0
11000000.10100000.00000000.00000000
```

##### 2) ะะตัะตะฒะพะด ะผะฐัะบะธ `255.255.255.0` ะฒ ะฟัะตัะธะบัะฝัั ะธ ะดะฒะพะธัะฝัั ะทะฐะฟะธัั, `/15` ะฒ ะพะฑััะฝัั ะธ ะดะฒะพะธัะฝัั, `11111111.11111111.11111111.11110000` ะฒ ะพะฑััะฝัั ะธ ะฟัะตัะธะบัะฝัั

```bash
dec 255.255.255.0
prefix /24
bin 11111111.11111111.11111111. 00000000

prefix /15
bin 11111111.1111111 0.00000000.00000000
dec  255.254.0.0

bin 11111111.11111111.11111111.1111 0000
dec 255.255.255.240
prefix /28
```

##### 3) ะะธะฝะธะผะฐะปัะฝัะน ะธ ะผะฐะบัะธะผะฐะปัะฝัะน ัะพัั ะฒ ัะตัะธ `12.167.38.4` ะฟัะธ ะผะฐัะบะฐั:

`/8`

```bash
mask prefix /8
ip dec 12.167.38.4         = bin 00001100. 10100111.00100110.00000100
mask dec 255.0.0.0         = bin 11111111. 00000000.00000000.00000000
network dec 12.0.0.0       = bin 00001100. 00000000.00000000.00000000
HostMin dec 12.0.0.1       = bin 00001100. 00000000.00000000.00000001
HostMax dec 12.255.255.254 = bin 00001100. 11111111.11111111.11111110

ะะพะปะธัะตััะฒะพ ะฐะดัะตัะพะฒ:
2^(32 - 8 =24 bytes) = 16777214 + 2 ะฐะดัะตัะฐ (network ะธ broadcast)
```

`11111111.11111111.00000000.00000000`

```bash
mask prefix /16
ip dec 12.167.38.4         = bin 00001100.10100111. 00100110.00000100
mask dec 255.255.0.0       = bin 11111111.11111111. 00000000.00000000
network dec 12.167.0.0     = bin 00001100.10100111. 00000000.00000000
HostMin dec 12.167.0.1     = bin 00001100.10100111. 00000000.00000001
HostMax dec 12.167.255.254 = bin 00001100.10100111. 11111111.11111110

ะะพะปะธัะตััะฒะพ ะฐะดัะตัะพะฒ:
2^16 = 65534 + 2 ะฐะดัะตัะฐ (network ะธ broadcast)
```

`255.255.254.0`

```bash
mask prefix /23
ip dec 12.167.38.4          = bin 00001100.10100111.0010011 0.00000100
mask dec 255.255.254.0      = bin 11111111.11111111.1111111 0.00000000
network dec 12.167.38.0     = bin 00001100.10100111.0010011 0.00000000 
broadcast dec 12.167.39.255 = bin 00001100.10100111.0010011 1.11111111

2^(32-23) = 510 + 2 ะฐะดัะตัะฐ (network ะธ broadcast)
```

`/4`

```bash
mask prefix /4
ip dec 12.167.38.4           = bin 0000 1100.10100111.00100110.00000100
mask dec 240.0.0.0           = bin 1111 0000.00000000.00000000.00000000
network dec 0.0.0.0          = bin 0000 0000.00000000.00000000.00000000
broadcast dec 15.255.255.255 = bin 0000 1111.11111111.11111111.11111111
HostMin dec 0.0.0.1          = bin 0000 0000.00000000.00000000.00000001
HostMax dec 15.255.255.254   = bin 0000 1111.11111111.11111111.11111110

2^28 = 268435454 + 2 ะฐะดัะตัะฐ (network ะธ broadcast)
```

#### 1.2. localhost

`localhost (ยซะผะตััะฝัะนยป ะพั ะฐะฝะณะป. local โ ััะพั ะบะพะผะฟัััะตั) โ ััะฐะฝะดะฐััะฝะพะต, ะพัะธัะธะฐะปัะฝะพ ะทะฐัะตะทะตัะฒะธัะพะฒะฐะฝะฝะพะต ะดะพะผะตะฝะฝะพะต ะธะผั ะดะปั ัะฐััะฝัั IP-ะฐะดัะตัะพะฒ ะฒ ะดะธะฐะฟะฐะทะพะฝะต 127.0.0.1 โ 127.255.255.254`

##### ะะฟัะตะดะตะปะธัั ะธ ะทะฐะฟะธัะฐัั ะฒ ะพัััั, ะผะพะถะฝะพ ะปะธ ะพะฑัะฐัะธัััั ะบ ะฟัะธะปะพะถะตะฝะธั, ัะฐะฑะพัะฐััะตะผั ะฝะฐ localhost, ัะพ ัะปะตะดัััะธะผะธ IP:

```bash
194.34.23.100/16 - ะฝะตั ะดะพัััะฟะฐ
127.0.0.2/24 - ะตััั
127.1.0.1/8 - ะตััั
128.0.0.1/8 - ะฝะตั ะดะพัััะฟะฐ
```

#### 1.3. ะะธะฐะฟะฐะทะพะฝั ะธ ัะตะณะผะตะฝัั ัะตัะตะน

`Privat(ัะฐััะฝัะต ะธะปะธ ัะตััะต) IPv4:
10.0.0.0 - 10.255.255.255 (/8)
172.16.0.0 - 172.31.255.255 (/12)
192.168.0.0 - 192.168.255.255 (/16)
ะะฐ ะธัะบะปััะตะฝะธะตะผ ะฐะดัะตัะพะฒ, ัะบะฐะทะฐะฝะฝัั ะฒััะต, ะฟัะฑะปะธัะฝัะต(Public) IP-ะฐะดัะตัะฐ ะฒะฐััะธัััััั ะพั 1 ะดะพ 191.`

##### ะะฟัะตะดะตะปะธัั ะธ ะทะฐะฟะธัะฐัั ะฒ ะพัััั:

##### 1) ะบะฐะบะธะต ะธะท ะฟะตัะตัะธัะปะตะฝะฝัั IP ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะฒ ะบะฐัะตััะฒะต ะฟัะฑะปะธัะฝะพะณะพ, ะฐ ะบะฐะบะธะต ัะพะปัะบะพ ะฒ ะบะฐัะตััะฒะต ัะฐััะฝัั:

```bash
10.0.0.45/8       - Privat
134.43.0.2/16     - Public
192.168.4.2/16    - Privat
172.20.250.4/12   - Privat
172.0.2.1/12      - Public
192.172.0.1/12    - Public
172.68.0.2/12     - Public
172.16.255.255/12 - Privat
10.10.10.10/8     - Privat
192.169.168.1/16  - Public
```

##### 2) ะบะฐะบะธะต ะธะท ะฟะตัะตัะธัะปะตะฝะฝัั IP ะฐะดัะตัะพะฒ ัะปัะทะฐ ะฒะพะทะผะพะถะฝั ั ัะตัะธ `10.10.0.0/18`:

HostMin 10.10.0.1
HostMax 10.10.63.254

```bash
10.0.0.1 - out of range 
10.10.0.2 - ok
10.10.10.10 - ok
10.10.100.1 - out of range
10.10.1.255 - ok
```

## Part 2. ะกัะฐัะธัะตัะบะฐั ะผะฐัััััะธะทะฐัะธั ะผะตะถะดั ะดะฒัะผั ะผะฐัะธะฝะฐะผะธ

##### ะะพะดะฝััั ะดะฒะต ะฒะธัััะฐะปัะฝัะต ะผะฐัะธะฝั (ะดะฐะปะตะต -- ws1 ะธ ws2)

##### ะก ะฟะพะผะพััั ะบะพะผะฐะฝะดั `ip a` ะฟะพัะผะพััะตัั ัััะตััะฒัััะธะต ัะตัะตะฒัะต ะธะฝัะตััะตะนัั

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะน ะบะพะผะฐะฝะดั.

<img src="misc/images/p2002.png" alt="ip a" />

##### ะะฟะธัะฐัั ัะตัะตะฒะพะน ะธะฝัะตััะตะนั, ัะพะพัะฒะตัััะฒัััะธะน ะฒะฝัััะตะฝะฝะตะน ัะตัะธ, ะฝะฐ ะพะฑะตะธั ะผะฐัะธะฝะฐั ะธ ะทะฐะดะฐัั ัะปะตะดัััะธะต ะฐะดัะตัะฐ ะธ ะผะฐัะบะธ: ws1 - `192.168.100.10`, ะผะฐัะบะฐ `/16`, ws2 - `172.24.116.8`, ะผะฐัะบะฐ `/12`

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ัะพะดะตัะถะฐะฝะธะตะผ ะธะทะผะตะฝัะฝะฝะพะณะพ ัะฐะนะปะฐ *etc/netplan/00-installer-config.yaml* ะดะปั ะบะฐะถะดะพะน ะผะฐัะธะฝั.

<img src="misc/images/p2001.png" alt="netplan" />

##### ะัะฟะพะปะฝะธัั ะบะพะผะฐะฝะดั `netplan apply` ะดะปั ะฟะตัะตะทะฐะฟััะบะฐ ัะตัะฒะธัะฐ ัะตัะธ

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะน ะบะพะผะฐะฝะดั.  \
  `sudo netplan apply`

<img src="misc/images/p2003.png" alt="sudo netplan apply" />

#### 2.1. ะะพะฑะฐะฒะปะตะฝะธะต ััะฐัะธัะตัะบะพะณะพ ะผะฐัััััะฐ ะฒัััะฝัั

##### ะะพะฑะฐะฒะธัั ััะฐัะธัะตัะบะธะน ะผะฐััััั ะพั ะพะดะฝะพะน ะผะฐัะธะฝั ะดะพ ะดััะณะพะน ะธ ะพะฑัะฐัะฝะพ ะฟัะธ ะฟะพะผะพัะธ ะบะพะผะฐะฝะดั ะฒะธะดะฐ `ip r add`

##### ะัะพะฟะธะฝะณะพะฒะฐัั ัะพะตะดะธะฝะตะฝะธะต ะผะตะถะดั ะผะฐัะธะฝะฐะผะธ

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด.
  \
  ws1:$`sudo ip route add 172.24.116.8 via 192.168.100.10 dev enp0s8`  \
  ws2:$`sudo ip route add 192.168.100.10 via 172.24.116.8 dev enp0s8`

<img src="misc/images/p2004route.png" alt="sudo ip rout add" />

ws1:$`ping -c 4 172.24.116.8`

<img src="misc/images/p2004ws1ping.png" alt="ws1 ping" />

ws2:$`ping -c 4  192.168.100.10`

<img src="misc/images/p2004ws2ping.png" alt="ws2 ping" />  

#### 2.2. ะะพะฑะฐะฒะปะตะฝะธะต ััะฐัะธัะตัะบะพะณะพ ะผะฐัััััะฐ ั ัะพััะฐะฝะตะฝะธะตะผ

##### ะะตัะตะทะฐะฟัััะธัั ะผะฐัะธะฝั

##### ะะพะฑะฐะฒะธัั ััะฐัะธัะตัะบะธะน ะผะฐััััั ะพั ะพะดะฝะพะน ะผะฐัะธะฝั ะดะพ ะดััะณะพะน ั ะฟะพะผะพััั ัะฐะนะปะฐ *etc/netplan/00-installer-config.yaml*

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ัะพะดะตัะถะฐะฝะธะตะผ ะธะทะผะตะฝัะฝะฝะพะณะพ ัะฐะนะปะฐ *etc/netplan/00-installer-config.yaml*.

<img src="misc/images/p2200netplan.png" alt="netplan route" />

##### ะัะพะฟะธะฝะณะพะฒะฐัั ัะพะตะดะธะฝะตะฝะธะต ะผะตะถะดั ะผะฐัะธะฝะฐะผะธ

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะน ะบะพะผะฐะฝะดั.

ws1:$`sudo netplan apply`  \
ws1:$`netstat -rn`  \
ws1:$`ping -c 3 172.24.116.8`  \
ws2:$`sudo netplan apply`  \
ws2:$`route -r`  \
ws2:$`ping -c 4  192.168.100.10`  \
<img src="misc/images/p2200ping.png" alt="ping" />

## Part 3. ะฃัะธะปะธัะฐ **iperf3**

#### 3.1. ะกะบะพัะพััั ัะพะตะดะธะฝะตะฝะธั

##### ะะตัะตะฒะตััะธ ะธ ะทะฐะฟะธัะฐัั ะฒ ะพัััั:

8 Mbps = 1 MB/s  \
100 MB/s = 819 200 Kbps  \
1 Gbps  = 1024 Mbps

#### 3.2. ะฃัะธะปะธัะฐ **iperf3**

##### ะะทะผะตัะธัั ัะบะพัะพััั ัะพะตะดะธะฝะตะฝะธั ะผะตะถะดั ws1 ะธ ws2

ws1:$`sudo ufw allow 5201` - ะฟะพัั 5201 ะฒ ะธัะบะปััะตะฝะธ ัะฐะตัะฒะพะปะฐ  \
ws1:$`iperf3 -s` - ะฟะตัะฒะฐั ะผะฐัะฝะฐ ะฒ ัะตะถะธะผะต ัะตัะฒะตัะฐ ัะปััะฐะตั ะฟะพัั ๐กฉ  \
ws2:$`iperf3 -ั  192.168.100.10 -f M` - ws2 ะฟะพะดะบะปััะฐะตััั ะบ ws1 ะฒ ัะตะถะธะผะต ะบะปะธะตะฝัะฐ, ะฒัะฒะพะด ะฒ ะผะตะณะพะฑะฐะนัะฐั.

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด.

<img src="misc/images/p3200.png" alt="iperf3" />

## Part 4. ะกะตัะตะฒะพะน ัะบัะฐะฝ

`-` ะะพัะปะต ัะพะตะดะธะฝะตะฝะธั ะผะฐัะธะฝ, ะฟะตัะตะด ะฝะฐะผะธ ััะพะธั ัะปะตะดัััะฐั ะทะฐะดะฐัะฐ: ะบะพะฝััะพะปะธัะพะฒะฐัั ะธะฝัะพัะผะฐัะธั, ะฟัะพัะพะดัััั ะฟะพ ัะพะตะดะธะฝะตะฝะธั. ะะปั ััะพะณะพ ะธัะฟะพะปัะทััััั ัะตัะตะฒัะต ัะบัะฐะฝั.

#### 4.1. ะฃัะธะปะธัะฐ **iptables**

##### ะกะพะทะดะฐัั ัะฐะนะป */etc/firewall.sh*, ะธะผะธัะธััััะธะน ัะฐะตัะฒะพะปะป, ะฝะฐ ws1 ะธ ws2:

```shell
#!/bin/sh

# ะฃะดะฐะปะตะฝะธะต ะฒัะตั ะฟัะฐะฒะธะป ะฒ ัะฐะฑะปะธัะต "filter" (ะฟะพ-ัะผะพะปัะฐะฝะธั).
iptables โF
iptables -X
```

ะดะตะนััะฒะธั iptables:  \
-A - ะดะพะฑะฐะฒะธัั ะฟัะฐะฒะธะปะพ ะฒ ัะตะฟะพัะบั;  \
-ะก - ะฟัะพะฒะตัะธัั ะฒัะต ะฟัะฐะฒะธะปะฐ;  \
-D - ัะดะฐะปะธัั ะฟัะฐะฒะธะปะพ;  \
-I - ะฒััะฐะฒะธัั ะฟัะฐะฒะธะปะพ ั ะฝัะถะฝัะผ ะฝะพะผะตัะพะผ;  \
-L - ะฒัะฒะตััะธ ะฒัะต ะฟัะฐะฒะธะปะฐ ะฒ ัะตะบััะตะน ัะตะฟะพัะบะต;  \
-S - ะฒัะฒะตััะธ ะฒัะต ะฟัะฐะฒะธะปะฐ;  \
-F - ะพัะธััะธัั ะฒัะต ะฟัะฐะฒะธะปะฐ;  \
-N - ัะพะทะดะฐัั ัะตะฟะพัะบั;  \
-X - ัะดะฐะปะธัั ัะตะฟะพัะบั;  \
-P - ัััะฐะฝะพะฒะธัั ะดะตะนััะฒะธะต ะฟะพ ัะผะพะปัะฐะฝะธั.  \
ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะพะฟัะธะธ ะดะปั ะฟัะฐะฒะธะป:  \
-p - ัะบะฐะทะฐัั ะฟัะพัะพะบะพะป, ะพะดะธะฝ ะธะท tcp, udp, udplite, icmp, icmpv6,esp, ah, sctp,
mh;  \
-s - ัะบะฐะทะฐัั ip ะฐะดัะตั ััััะพะนััะฒะฐ-ะพัะฟัะฐะฒะธัะตะปั ะฟะฐะบะตัะฐ;  \
-d - ัะบะฐะทะฐัั ip ะฐะดัะตั ะฟะพะปััะฐัะตะปั;  \
-i - ะฒัะพะดะฝะพะน ัะตัะตะฒะพะน ะธะฝัะตััะตะนั;  \
-o - ะธััะพะดััะธะน ัะตัะตะฒะพะน ะธะฝัะตััะตะนั;  \
-j - ะฒัะฑัะฐัั ะดะตะนััะฒะธะต, ะตัะปะธ ะฟัะฐะฒะธะปะพ ะฟะพะดะพัะปะพ.

##### ะัะถะฝะพ ะดะพะฑะฐะฒะธัั ะฒ ัะฐะนะป ะฟะพะดััะด ัะปะตะดัััะธะต ะฟัะฐะฒะธะปะฐ:

##### 1) ะฝะฐ ws1 ะฟัะธะผะตะฝะธัั ัััะฐัะตะณะธั ะบะพะณะดะฐ ะฒ ะฝะฐัะฐะปะต ะฟะธัะตััั ะทะฐะฟัะตัะฐััะตะต ะฟัะฐะฒะธะปะพ, ะฐ ะฒ ะบะพะฝัะต ะฟะธัะตััั ัะฐะทัะตัะฐััะตะต ะฟัะฐะฒะธะปะพ (ััะพ ะบะฐัะฐะตััั ะฟัะฝะบัะพะฒ 4 ะธ 5)

##### 2) ะฝะฐ ws2 ะฟัะธะผะตะฝะธัั ัััะฐัะตะณะธั ะบะพะณะดะฐ ะฒ ะฝะฐัะฐะปะต ะฟะธัะตััั ัะฐะทัะตัะฐััะตะต ะฟัะฐะฒะธะปะพ, ะฐ ะฒ ะบะพะฝัะต ะฟะธัะตััั ะทะฐะฟัะตัะฐััะตะต ะฟัะฐะฒะธะปะพ (ััะพ ะบะฐัะฐะตััั ะฟัะฝะบัะพะฒ 4 ะธ 5)

##### 3) ะพัะบัััั ะฝะฐ ะผะฐัะธะฝะฐั ะดะพัััะฟ ะดะปั ะฟะพััะฐ 22 (ssh) ะธ ะฟะพััะฐ 80 (http)

##### 4) ะทะฐะฟัะตัะธัั *echo reply* (ะผะฐัะธะฝะฐ ะฝะต ะดะพะปะถะฝะฐ "ะฟะธะฝะณะพะฒะฐััััโ, ั.ะต. ะดะพะปะถะฝะฐ ะฑััั ะฑะปะพะบะธัะพะฒะบะฐ ะฝะฐ OUTPUT)

##### 5) ัะฐะทัะตัะธัั *echo reply* (ะผะฐัะธะฝะฐ ะดะพะปะถะฝะฐ "ะฟะธะฝะณะพะฒะฐัััั")

`sudo touch /etc/firewall.sh`  \
`sudo mcedit /etc/firewall.sh`

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ัะพะดะตัะถะฐะฝะธะตะผ ัะฐะนะปะฐ */etc/firewall* ะดะปั ะบะฐะถะดะพะน ะผะฐัะธะฝั.

<img src="misc/images/p4100.png" alt="/etc/firewall.sh" />

##### ะะฐะฟัััะธัั ัะฐะนะปั ะฝะฐ ะพะฑะตะธั ะผะฐัะธะฝะฐั ะบะพะผะฐะฝะดะฐะผะธ:

`sudo chmod +x /etc/firewall.sh`  \
`sudo sh /etc/firewall.sh`  \
`sudo iptables -L`  \
`sudo ping -c 3 <ip-address>`

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ะทะฐะฟััะบะพะผ ะพะฑะพะธั ัะฐะนะปะพะฒ.

<img src="misc/images/p4101.png" alt="pings" />

- ะ ะพััััะต ะพะฟะธัะฐัั ัะฐะทะฝะธัั ะผะตะถะดั ัััะฐัะตะณะธัะผะธ, ะฟัะธะผะตะฝัะฝะฝัะผะธ ะฒ ะฟะตัะฒะพะผ ะธ ะฒัะพัะพะผ ัะฐะนะปะฐั.
  
  ```
  ะัะฐะฒะธะปะฐ iptables ะฒ firewall.sh ะฟัะพะฒะตัััััั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ. ะัะปะธ ััะปะพะฒะธะต ะฟะพะดัะพะดะธั, ัะพ ะฒัะฟะพะปะฝัะตััั ะดะตะนััะฒะธะต(-j).
  ws1 ะฟะตัะฒัะผ ะฟัะฐะฒะธะปะพะผ ะพัะบะปะพะฝัะตั ะฟะฐะบะตัั imcp. ะัะพะฒะตัะธะผ ะฟัะธ ะฟะพะผะพัะธ ะบะพะผะฐะฝะดั ping. ะะฐะบะตัั ะฝะต ะฒะพะทะฒัะฐัะฐัััั.
  ws2 ะฟะตัะฒัะผ ะฟัะฐะฒะธะปะพะผ ัะฐะทัะตัะฐะตั ะฟะฐะบะตัั imcp. ะัะพะฒะตัะธะผ ะฟัะธ ะฟะพะผะพัะธ ะบะพะผะฐะฝะดั ping. ะะฐะบะตัั ะฟัะธัะพะดัั ะธัะฟัะฐะฒะฝะพ.
  ```
  
  `ICMP (ะฐะฝะณะป. Internet Control Message Protocol โ ะฟัะพัะพะบะพะป ะผะตะถัะตัะตะฒัั ัะฟัะฐะฒะปัััะธั ัะพะพะฑัะตะฝะธะน[1]) โ ัะตัะตะฒะพะน ะฟัะพัะพะบะพะป, ะฒัะพะดััะธะน ะฒ ััะตะบ ะฟัะพัะพะบะพะปะพะฒ TCP/IP. ะ ะพัะฝะพะฒะฝะพะผ ICMP ะธัะฟะพะปัะทัะตััั ะดะปั ะฟะตัะตะดะฐัะธ ัะพะพะฑัะตะฝะธะน ะพะฑ ะพัะธะฑะบะฐั ะธ ะดััะณะธั ะธัะบะปััะธัะตะปัะฝัั ัะธััะฐัะธัั, ะฒะพะทะฝะธะบัะธั ะฟัะธ ะฟะตัะตะดะฐัะต ะดะฐะฝะฝัั, ะฝะฐะฟัะธะผะตั, ะทะฐะฟัะฐัะธะฒะฐะตะผะฐั ััะปัะณะฐ ะฝะตะดะพัััะฟะฝะฐ ะธะปะธ ัะพัั, ะธะปะธ ะผะฐัััััะธะทะฐัะพั ะฝะต ะพัะฒะตัะฐัั. ะขะฐะบะถะต ะฝะฐ ICMP ะฒะพะทะปะฐะณะฐัััั ะฝะตะบะพัะพััะต ัะตัะฒะธัะฝัะต ััะฝะบัะธะธ (services).`

#### 4.2. ะฃัะธะปะธัะฐ **nmap**

##### ะะพะผะฐะฝะดะพะน **ping** ะฝะฐะนัะธ ะผะฐัะธะฝั, ะบะพัะพัะฐั ะฝะต "ะฟะธะฝะณัะตััั", ะฟะพัะปะต ัะตะณะพ ััะธะปะธัะพะน **nmap** ะฟะพะบะฐะทะฐัั, ััะพ ัะพัั ะผะฐัะธะฝั ะทะฐะฟััะตะฝ

*ะัะพะฒะตัะบะฐ: ะฒ ะฒัะฒะพะดะต nmap ะดะพะปะถะฝะพ ะฑััั ัะบะฐะทะฐะฝะพ: `Host is up`*

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด **ping** ะธ **nmap**.

<img src="misc/images/p4200.png" alt="nmap" />

##### ะกะพััะฐะฝะธัั ะดะฐะผะฟั ะพะฑัะฐะทะพะฒ ะฒะธัััะฐะปัะฝัั ะผะฐัะธะฝ

## Part 5. ะกัะฐัะธัะตัะบะฐั ะผะฐัััััะธะทะฐัะธั ัะตัะธ

ะกะตัั: \
<img src="misc/images/part5_network.png" alt="part5_network" width="500"/>

##### ะะพะดะฝััั ะฟััั ะฒะธัััะฐะปัะฝัั ะผะฐัะธะฝ (3 ัะฐะฑะพัะธะต ััะฐะฝัะธะธ (ws11, ws21, ws22) ะธ 2 ัะพััะตัะฐ (r1, r2))

#### 5.1. ะะฐัััะพะนะบะฐ ะฐะดัะตัะพะฒ ะผะฐัะธะฝ

##### ะะฐัััะพะธัั ะบะพะฝัะธะณััะฐัะธะธ ะผะฐัะธะฝ ะฒ *etc/netplan/00-installer-config.yaml* ัะพะณะปะฐัะฝะพ ัะตัะธ ะฝะฐ ัะธััะฝะบะต.

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ัะพะดะตัะถะฐะฝะธะตะผ ัะฐะนะปะฐ *etc/netplan/00-installer-config.yaml* ะดะปั ะบะฐะถะดะพะน ะผะฐัะธะฝั.

<img src="misc/images/p5101.png" alt="pings" />  \
<img src="misc/images/p5102.png" alt="pings" />

##### ะะตัะตะทะฐะฟัััะธัั ัะตัะฒะธั ัะตัะธ. ะัะปะธ ะพัะธะฑะพะบ ะฝะตั, ัะพ ะบะพะผะฐะฝะดะพะน `ip -4 a` ะฟัะพะฒะตัะธัั, ััะพ ะฐะดัะตั ะผะฐัะธะฝั ะทะฐะดะฐะฝ ะฒะตัะฝะพ. ะขะฐะบะถะต ะฟัะพะฟะธะฝะณะพะฒะฐัั ws22 ั ws21. ะะฝะฐะปะพะณะธัะฝะพ ะฟัะพะฟะธะฝะณะพะฒะฐัั r1 ั ws11.

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด.

<img src="misc/images/p5103.png" alt="pings" />  \
<img src="misc/images/p5104.png" alt="pings" />  \
<img src="misc/images/p5105.png" alt="pings" />

#### 5.2. ะะบะปััะตะฝะธะต ะฟะตัะตะฐะดัะตัะฐัะธะธ IP-ะฐะดัะตัะพะฒ.

##### ะะปั ะฒะบะปััะตะฝะธั ะฟะตัะตะฐะดัะตัะฐัะธะธ IP, ะฒัะฟะพะปะฝะธัะต ะบะพะผะฐะฝะดั ะฝะฐ ัะพััะตัะฐั:

`sysctl -w net.ipv4.ip_forward=1`
*ะัะธ ัะฐะบะพะผ ะฟะพะดัะพะดะต ะฟะตัะตะฐะดัะตัะฐัะธั ะฝะต ะฑัะดะตั ัะฐะฑะพัะฐัั ะฟะพัะปะต ะฟะตัะตะทะฐะณััะทะบะธ ัะธััะตะผั.*

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะน ะบะพะผะฐะฝะดั.

<img src="misc/images/p5201.png" alt="net.ipv4.ip_forward = 1" />

##### ะัะบัะพะนัะต ัะฐะนะป */etc/sysctl.conf* ะธ ะดะพะฑะฐะฒััะต ะฒ ะฝะตะณะพ ัะปะตะดััััั ัััะพะบั:

`net.ipv4.ip_forward = 1`
*ะัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ ััะพะณะพ ะฟะพะดัะพะดะฐ, IP-ะฟะตัะตะฐะดัะตัะฐัะธั ะฒะบะปััะตะฝะฐ ะฝะฐ ะฟะพััะพัะฝะฝะพะน ะพัะฝะพะฒะต.*

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ัะพะดะตัะถะฐะฝะธะตะผ ะธะทะผะตะฝัะฝะฝะพะณะพ ัะฐะนะปะฐ */etc/sysctl.conf*.

<img src="misc/images/p5202.png" alt="net.ipv4.ip_forward = 1" />

#### 5.3. ะฃััะฐะฝะพะฒะบะฐ ะผะฐัััััะฐ ะฟะพ-ัะผะพะปัะฐะฝะธั

ะัะธะผะตั ะฒัะฒะพะดะฐ ะบะพะผะฐะฝะดั `ip r` ะฟะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ัะปัะทะฐ:

```
default via 10.10.0.1 dev eth0
10.10.0.0/18 dev eth0 proto kernel scope link src 10.10.0.2
```

##### ะะฐัััะพะธัั ะผะฐััััั ะฟะพ-ัะผะพะปัะฐะฝะธั (ัะปัะท) ะดะปั ัะฐะฑะพัะธั ััะฐะฝัะธะน. ะะปั ััะพะณะพ ะดะพะฑะฐะฒะธัั gateway4 \[ip ัะพััะตัะฐ\] ะฒ ัะฐะนะปะต ะบะพะฝัะธะณััะฐัะธะน

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ัะพะดะตัะถะฐะฝะธะตะผ ัะฐะนะปะฐ *etc/netplan/00-installer-config.yaml*.

<img src="misc/images/p5301.png"  />  \
<img src="misc/images/p5302.png"  />

##### ะัะทะฒะฐัั `ip r` ะธ ะฟะพะบะฐะทะฐัั, ััะพ ะดะพะฑะฐะฒะธะปัั ะผะฐััััั ะฒ ัะฐะฑะปะธัั ะผะฐัััััะธะทะฐัะธะธ

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะน ะบะพะผะฐะฝะดั.

<img src="misc/images/p5303.png"  />

##### ะัะพะฟะธะฝะณะพะฒะฐัั ั ws11 ัะพััะตั r2 ะธ ะฟะพะบะฐะทะฐัั ะฝะฐ r2, ััะพ ะฟะธะฝะณ ะดะพัะพะดะธั. ะะปั ััะพะณะพ ะธัะฟะพะปัะทะพะฒะฐัั ะบะพะผะฐะฝะดั:

`tcpdump -tn -i eth1`

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด.

<img src="misc/images/p5304.png"  />

#### 5.4. ะะพะฑะฐะฒะปะตะฝะธะต ััะฐัะธัะตัะบะธั ะผะฐัััััะพะฒ

##### ะะพะฑะฐะฒะธัั ะฒ ัะพััะตัั r1 ะธ r2 ััะฐัะธัะตัะบะธะต ะผะฐัััััั ะฒ ัะฐะนะปะต ะบะพะฝัะธะณััะฐัะธะน. ะัะธะผะตั ะดะปั r1 ะผะฐัััััะฐ ะฒ ัะตัะบั 10.20.0.0/26:

```shell
# ะะพะฑะฐะฒะธัั ะฒ ะบะพะฝะตั ะพะฟะธัะฐะฝะธั ัะตัะตะฒะพะณะพ ะธะฝัะตััะตะนัะฐ eth1:
- to: 10.20.0.0
  via: 10.100.0.12
```

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ัะพะดะตัะถะฐะฝะธะตะผ ะธะทะผะตะฝัะฝะฝะพะณะพ ัะฐะนะปะฐ *etc/netplan/00-installer-config.yaml* ะดะปั ะบะฐะถะดะพะณะพ ัะพััะตัะฐ.

<img src="misc/images/p5401.png"  />

##### ะัะทะฒะฐัั `ip r` ะธ ะฟะพะบะฐะทะฐัั ัะฐะฑะปะธัั ั ะผะฐัััััะฐะผะธ ะฝะฐ ะพะฑะพะธั ัะพััะตัะฐั. ะัะธะผะตั ัะฐะฑะปะธัั ะฝะฐ r1:

```
10.100.0.0/16 dev eth1 proto kernel scope link src 10.100.0.11
10.20.0.0/26 via 10.100.0.12 dev eth1
10.10.0.0/18 dev eth0 proto kernel scope link src 10.10.0.1
```

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะน ะบะพะผะฐะฝะดั.

<img src="misc/images/p5402.png"  />

##### ะะฐะฟัััะธัั ะบะพะผะฐะฝะดั ะฝะฐ ws11:

`ip r list 10.10.0.0/[ะผะฐัะบะฐ ัะตัะธ]` ะธ `ip r list 0.0.0.0/0`

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด.

<img src="misc/images/p5403.png"  />

- ะ ะพััััะต ะพะฑัััะฝะธัั, ะฟะพัะตะผั ะดะปั ะฐะดัะตัะฐ 10.10.0.0/18 ะฑัะป ะฒัะฑัะฐะฝ ะผะฐััััั, ะพัะปะธัะฝัะน ะพั 0.0.0.0/0, ัะพัั ะพะฝ ะฟะพะฟะฐะดะฐะตั ะฟะพะด ะผะฐััััั ะฟะพ-ัะผะพะปัะฐะฝะธั.  \
    ะญัะพ ะผะพะถะฝะพ ะพะฑัััะฝะธัั ัะตะผ, ััะพ ะผะฐััััั ะฟะพ ัะผะพะปัะฐะฝะธั (defaul route) ะฒัะฟะพะปะฝัะตััั ะฒ ัะปััะฐะต ะพััััััะฒะธั ะธะฝัั. ะ ั ะฝะฐั ัะฐะบะพะฒัะต ะตััั ะฒ netplan'ะต.

#### 5.5. ะะพัััะพะตะฝะธะต ัะฟะธัะบะฐ ะผะฐัััััะธะทะฐัะพัะพะฒ

ะัะธะผะตั ะฒัะฒะพะดะฐ ััะธะปะธัั **traceroute** ะฟะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ัะปัะทะฐ:

```
1 10.10.0.1 0 ms 1 ms 0 ms
2 10.100.0.12 1 ms 0 ms 1 ms
3 10.20.0.10 12 ms 1 ms 3 ms
```

##### ะะฐะฟัััะธัั ะฝะฐ r1 ะบะพะผะฐะฝะดั ะดะฐะผะฟะฐ:

`tcpdump -tnv -i eth0`

##### ะัะธ ะฟะพะผะพัะธ ััะธะปะธัั **traceroute** ะฟะพัััะพะธัั ัะฟะธัะพะบ ะผะฐัััััะธะทะฐัะพัะพะฒ ะฝะฐ ะฟััะธ ะพั ws11 ะดะพ ws21

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝั ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด (tcpdump ะธ traceroute).

<img src="misc/images/p5501.png"  />

- ะ ะพััััะต, ะพะฟะธัะฐััั ะฝะฐ ะฒัะฒะพะด, ะฟะพะปััะตะฝะฝัะน ะธะท ะดะฐะผะฟะฐ ะฝะฐ r1, ะพะฑัััะฝะธัั ะฟัะธะฝัะธะฟ ัะฐะฑะพัั ะฟะพัััะพะตะฝะธั ะฟััะธ ะฟัะธ ะฟะพะผะพัะธ **traceroute**.

```bash
ะะพะผะฐะฝะดะฐ traceroute  ะพัะฟัะฐะฒะปัะตั UDP ะฟะฐะบะตั ั TTL=1(ะฒัะตะผั ะถะธะทะฝะธ) ะธ ัะผะพััะธั ะฐะดัะตั ะพัะฒะตัะธะฒัะตะณะพ ัะทะปะฐ, 
ะดะฐะปััะต TTL=2, TTL=3 ะธ ัะฐะบ ะฟะพะบะฐ ะฝะต ะดะพััะธะณะฝะตั ัะตะปะธ. ะะฐะถะดัะน ัะฐะท ะพัะฟัะฐะฒะปัะตััั ะฟะพ ััะธ ะฟะฐะบะตัะฐ
 ะธ ะดะปั ะบะฐะถะดะพะณะพ ะธะท ะฝะธั ะธะทะผะตััะตััั ะฒัะตะผั ะฟัะพัะพะถะดะตะฝะธั. ะะฐะบะตั ะพัะฟัะฐะฒะปัะตััั ะฝะฐ ัะปััะฐะนะฝัะน ะฟะพัั, ะบะพัะพััะน, 
 ัะบะพัะตะต ะฒัะตะณะพ, ะฝะต ะทะฐะฝัั. ะะพะณะดะฐ ััะธะปะธัะฐ traceroute ะฟะพะปััะฐะตั ัะพะพะฑัะตะฝะธะต ะพั ัะตะปะตะฒะพะณะพ ัะทะปะฐ ะพ ัะพะผ, 
 ััะพ ะฟะพัั ะฝะตะดะพัััะฟะตะฝ ััะฐััะธัะพะฒะบะฐ ััะธัะฐะตััั ะทะฐะฒะตััะตะฝะฝะพะน.
ะั ะฝะฐัะปะธ ะฝัะถะฝัะน ัะทะตะป ั ะฟะตัะฒะพะณะพ ัะฐะทะฐ, ัะฐะบ ะบะฐะบ ั ะฝะฐั ะฝะฐ ัะพััะตัะต (r1 - ะพะฝ ะถะต ัะปัะท ะฟะพ ัะผะพะปัะฐะฝะธั)
 ะฟัะพะฟะธัะฐะฝ ััะฐัะธัะตัะบะธะน ะผะฐััััั ะฒ ะฝัะถะฝัั ัะตัั.
```

#### 5.6. ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพัะพะบะพะปะฐ **ICMP** ะฟัะธ ะผะฐัััััะธะทะฐัะธะธ

##### ะะฐะฟัััะธัั ะฝะฐ r1 ะฟะตัะตัะฒะฐั ัะตัะตะฒะพะณะพ ััะฐัะธะบะฐ, ะฟัะพัะพะดััะตะณะพ ัะตัะตะท eth0 ั ะฟะพะผะพััั ะบะพะผะฐะฝะดั:

`tcpdump -n -i eth0 icmp`

##### ะัะพะฟะธะฝะณะพะฒะฐัั ั ws11 ะฝะตัััะตััะฒัััะธะน IP (ะฝะฐะฟัะธะผะตั, *10.30.0.111*) ั ะฟะพะผะพััั ะบะพะผะฐะฝะดั:

`ping -c 1 10.30.0.111`

- ะ ะพัััั ะฟะพะผะตััะธัั ัะบัะธะฝ ั ะฒัะทะพะฒะพะผ ะธ ะฒัะฒะพะดะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะผะฐะฝะด.

<img title="" src="../misc/images/p5601.png" alt="">

##### ะกะพััะฐะฝะธัั ะดะฐะผะฟั ะพะฑัะฐะทะพะฒ ะฒะธัััะฐะปัะฝัั ะผะฐัะธะฝ

#### Partย6.ยะะธะฝะฐะผะธัะตัะบะฐัยะฝะฐัััะพะนะบะฐยIPยัยะฟะพะผะพัััย**DHCP**

`-`ยะกะปะตะดัััะธะผยะฝะฐัะธะผยัะฐะณะพะผยะฑัะดะตัยะฑะพะปะตะตยะฟะพะดัะพะฑะฝะพะตยะทะฝะฐะบะพะผััะฒะพยัะพยัะปัะถะฑะพะนย**DHCP**,ยะบะพัะพัััยััยัะถะตยะทะฝะฐะตัั.

*ะยะดะฐะฝะฝะพะผยะทะฐะดะฐะฝะธะธยะธัะฟะพะปัะทัััััยะฒะธัััะฐะปัะฝัะตยะผะฐัะธะฝัยะธะทยะงะฐััะธย5*

##### ะะปัยr2ยะฝะฐัััะพะธััยะฒยัะฐะนะปะตย*/etc/dhcp/dhcpd.conf*ยะบะพะฝัะธะณััะฐัะธัยัะปัะถะฑัย**DHCP**:

##### 1)ยัะบะฐะทะฐััยะฐะดัะตัยะผะฐัััััะธะทะฐัะพัะฐยะฟะพ-ัะผะพะปัะฐะฝะธั,ยDNS-ัะตัะฒะตัยะธยะฐะดัะตัยะฒะฝัััะตะฝะฝะตะนยัะตัะธ.ยะัะธะผะตัยัะฐะนะปะฐยะดะปัยr2:

```shell
subnet 10.100.0.0 netmask 255.255.0.0 {}

subnet 10.20.0.0 netmask 255.255.255.192

{
    range 10.20.0.2 10.20.0.50;
    option routers 10.20.0.1;
    option domain-name-servers 10.20.0.1;
}
```

##### 2)ยะฒยัะฐะนะปะตย*resolv.conf*ยะฟัะพะฟะธัะฐััย`nameserverย8.8.8.8.`

ะฃััะฐะฝะพะฒะบะฐ ะฝะตะดะพััะฐััะธั ะฟะฐะบะตัะพะฒ

`sudo apt install isc-dhcp-server`

`sudo apt install resolvconf`

ะัะพะฒะตัะบะฐ ะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต

`sudo systemctl enable isc-dhcp-server`

`sudo mcedit /etc/dhcp/dhcpd.conf`

<img title="" src="../misc/images/p6001.png" alt="">

##### ะฃะบะฐะทะฐััยMACยะฐะดัะตัยัยws11,ยะดะปัยััะพะณะพยะฒย*etc/netplan/00-installer-config.yaml*ยะฝะฐะดะพยะดะพะฑะฐะฒะธััยัััะพะบะธ:ย`macaddress:ย10:10:10:10:10:BA`,ย`dhcp4:ยtrue`

ะะตะบัะธััะตะผ netplan'ั ะฝะฐ ws11 ะธ ws21

<img title="" src="../misc/images/p6006netplans.png" alt="">

##### ะะตัะตะทะฐะณััะทะธััยัะปัะถะฑัย**DHCP**ยะบะพะผะฐะฝะดะพะนย`systemctlยrestartยisc-dhcp-server`.ยะะฐัะธะฝัยws21ยะฟะตัะตะทะฐะณััะทะธััยะฟัะธยะฟะพะผะพัะธย`reboot`ยะธยัะตัะตะทย`ipยa`ยะฟะพะบะฐะทะฐัั,ยััะพยะพะฝะฐยะฟะพะปััะธะปะฐยะฐะดัะตั.ยะขะฐะบะถะตยะฟัะพะฟะธะฝะณะพะฒะฐััยws22ยัยws21.

`sudo systemctl restart isc-dhcp-server`

`sudo systemctl status isc-dhcp-server`

<img title="" src="../misc/images/p6005r2.png" alt="">

<img title="" src="../misc/images/p6005ws21.png" alt="">

ะ r1 ะธ r2 ะฟัะธัะปะพััั ะฟะพะผะตะฝััั hostname ะฒ ัะฐะนะปะต /etc/hosts ะฝะฐ ะบะพััะตะบัะฝัะต, ััะพ ะฑั ะทะฐะฟัััะธะปัั resolv.

<img title="" src="../misc/images/p6004hosts.png" alt="">

`sudo systemctl start resolvconf`

`sudo systemctl enable resolvconf`

`sudo mcedit /etc/resolv.conf`

<img title="" src="../misc/images/p6003.png" alt="">

`sudo systemctl restart resolvconf`

`sudo systemctl status resolvconf`

<img title="" src="../misc/images/p6003status.png" alt="">

`sudo mcedit /etc/hosts`

<img title="" src="../misc/images/p6004hosts.png" alt="">

##### ะะปัยr1ยะฝะฐัััะพะธััยะฐะฝะฐะปะพะณะธัะฝะพยr2,ยะฝะพยัะดะตะปะฐััยะฒัะดะฐััยะฐะดัะตัะพะฒยัยะถะตััะบะพะนยะฟัะธะฒัะทะบะพะนยะบยMAC-ะฐะดัะตััย(ws11).ยะัะพะฒะตััะธยะฐะฝะฐะปะพะณะธัะฝัะตยัะตััั

<img title="" src="../misc/images/p6001r1ws11.png" alt="">

##### ะะฐะฟัะพัะธััยัยws21ยะพะฑะฝะพะฒะปะตะฝะธะตยipยะฐะดัะตัะฐ

-ยะยะพััััะตยะฟะพะผะตััะธััยัะบัะธะฝัยipยะดะพยะธยะฟะพัะปะตยะพะฑะฝะพะฒะปะตะฝะธั.

<img title="" src="../misc/images/p6007ws21.png" alt="">

-ยะยะพััััะตยะพะฟะธัะฐัั,ยะบะฐะบะธะผะธยะพะฟัะธัะผะธย**DHCP**ยัะตัะฒะตัะฐยะฟะพะปัะทะพะฒะฐะปะธััยะฒยะดะฐะฝะฝะพะผยะฟัะฝะบัะต.

`sudo dhclint -r enp0X` ัะดะฐะปะธัั IP

`sudo dhclint  enp0X` ะฝะฐะทะฝะฐัะธัั IP

`*X` - ะฝะพะผะตั ะธะฝัะตััะตัะฐ ัะพะณะปะฐัะฝะพ netplan

##### ะกะพััะฐะฝะธััยะดะฐะผะฟัยะพะฑัะฐะทะพะฒยะฒะธัััะฐะปัะฝััยะผะฐัะธะฝ

## Partย7.ย**NAT**

*ะยะดะฐะฝะฝะพะผยะทะฐะดะฐะฝะธะธยะธัะฟะพะปัะทัััััยะฒะธัััะฐะปัะฝัะตยะผะฐัะธะฝัยะธะทยะงะฐััะธย5*

##### ะยัะฐะนะปะตย*/etc/apache2/ports.conf*ยะฝะฐยws22ยะธยr2ยะธะทะผะตะฝะธััยัััะพะบัย`Listenย80`ยะฝะฐย`Listenย0.0.0.0:80`,ยัะพยะตัััยัะดะตะปะฐััยัะตัะฒะตัยApache2ยะพะฑัะตะดะพัััะฟะฝัะผ

`sudo apt inastall apache2 -y`

`sudo mcedit /etc/apache2/ports.conf`

-ยะยะพััััยะฟะพะผะตััะธััยัะบัะธะฝยัยัะพะดะตัะถะฐะฝะธะตะผยะธะทะผะตะฝัะฝะฝะพะณะพยัะฐะนะปะฐ.

<img title="" src="../misc/images/p7001.png" alt="">

##### ะะฐะฟัััะธััยะฒะตะฑ-ัะตัะฒะตัยApacheยะบะพะผะฐะฝะดะพะนย`serviceยapache2ยstart`ยะฝะฐยws22ยะธยr1

-ยะยะพััััยะฟะพะผะตััะธััยัะบัะธะฝัยัยะฒัะทะพะฒะพะผยะธยะฒัะฒะพะดะพะผยะธัะฟะพะปัะทะพะฒะฐะฝะฝะพะนยะบะพะผะฐะฝะดั.

<img title="" src="../misc/images/p7002.png" alt=""> ะะพะฑะฐะฒะธััยะฒยัะฐะตัะฒะพะป,ยัะพะทะดะฐะฝะฝัะนยะฟะพยะฐะฝะฐะปะพะณะธะธยัยัะฐะตัะฒะพะปะพะผยะธะทยะงะฐััะธย4,ยะฝะฐยr2ยัะปะตะดัััะธะตยะฟัะฐะฒะธะปะฐ:

##### 1)ยะฃะดะฐะปะตะฝะธะตยะฟัะฐะฒะธะปยะฒยัะฐะฑะปะธัะตยfilterย-ย`iptablesย-F`

##### 2)ยะฃะดะฐะปะตะฝะธะตยะฟัะฐะฒะธะปยะฒยัะฐะฑะปะธัะตย"NAT"ย-ย`iptablesย-Fย-tยnat`

##### 3)ยะัะฑัะฐััะฒะฐััยะฒัะตยะผะฐัััััะธะทะธััะตะผัะตยะฟะฐะบะตััย-ย`iptablesย--policyยFORWARDยDROP`

<img title="" src="../misc/images/p7003.png" alt="">

##### ะะฐะฟััะบะฐััยัะฐะนะปยัะฐะบะถะต,ยะบะฐะบยะฒยะงะฐััะธย4

<img title="" src="../misc/images/p7004.png" alt="" data-align="inline">

##### ะัะพะฒะตัะธััยัะพะตะดะธะฝะตะฝะธะตยะผะตะถะดัยws22ยะธยr1ยะบะพะผะฐะฝะดะพะนย`ping`

<img title="" src="../misc/images/p7005.png" alt="">

*ะัะธยะทะฐะฟััะบะตยัะฐะนะปะฐยัยััะธะผะธยะฟัะฐะฒะธะปะฐะผะธ,ยws22ยะฝะตยะดะพะปะถะฝะฐย"ะฟะธะฝะณะพะฒะฐัััั"ยัยr1*

##### ะะพะฑะฐะฒะธััยะฒยัะฐะนะปยะตััยะพะดะฝะพยะฟัะฐะฒะธะปะพ:

##### 4)ยะะฐะทัะตัะธััยะผะฐัััััะธะทะฐัะธัยะฒัะตัยะฟะฐะบะตัะพะฒยะฟัะพัะพะบะพะปะฐย**ICMP**

<img title="" src="../misc/images/p7006.png" alt="">

##### ะะฐะฟััะบะฐััยัะฐะนะปยัะฐะบะถะต,ยะบะฐะบยะฒยะงะฐััะธย4

##### ะัะพะฒะตัะธััยัะพะตะดะธะฝะตะฝะธะตยะผะตะถะดัยws22ยะธยr1ยะบะพะผะฐะฝะดะพะนย`ping`

*ะัะธยะทะฐะฟััะบะตยัะฐะนะปะฐยัยััะธะผะธยะฟัะฐะฒะธะปะฐะผะธ,ยws22ยะดะพะปะถะฝะฐย"ะฟะธะฝะณะพะฒะฐัััั"ยัยr1*

<img title="" src="../misc/images/p7008pingOk.png" alt="">

##### ะะพะฑะฐะฒะธััยะฒยัะฐะนะปยะตััยะดะฒะฐยะฟัะฐะฒะธะปะฐ:

##### 5)ยะะบะปััะธััย**SNAT**,ยะฐยะธะผะตะฝะฝะพยะผะฐัะบะธัะพะฒะฐะฝะธะตยะฒัะตัยะปะพะบะฐะปัะฝััยipยะธะทยะปะพะบะฐะปัะฝะพะนยัะตัะธ,ยะฝะฐัะพะดััะตะนััยะทะฐยr2ย(ะฟะพยะพะฑะพะทะฝะฐัะตะฝะธัะผยะธะทยะงะฐััะธย5ย-ยัะตััย10.20.0.0)

*ะกะพะฒะตั:ยััะพะธัยะฟะพะดัะผะฐััยะพยะผะฐัััััะธะทะฐัะธะธยะฒะฝัััะตะฝะฝะธัยะฟะฐะบะตัะพะฒ,ยะฐยัะฐะบะถะตยะฒะฝะตัะฝะธัยะฟะฐะบะตัะพะฒยัยัััะฐะฝะพะฒะปะตะฝะฝัะผยัะพะตะดะธะฝะตะฝะธะตะผ*

##### 6)ยะะบะปััะธััย**DNAT**ยะฝะฐย8080ยะฟะพััยะผะฐัะธะฝัยr2ยะธยะดะพะฑะฐะฒะธััยะบยะฒะตะฑ-ัะตัะฒะตััยApache,ยะทะฐะฟััะตะฝะฝะพะผัยะฝะฐยws22,ยะดะพัััะฟยะธะทะฒะฝะตยัะตัะธ

*ะกะพะฒะตั:ยััะพะธัยััะตััั,ยััะพยะฟัะธยะฟะพะฟััะบะตยะฟะพะดะบะปััะตะฝะธัยะฒะพะทะฝะธะบะฝะตัยะฝะพะฒะพะตยtcp-ัะพะตะดะธะฝะตะฝะธะต,ยะฟัะตะดะฝะฐะทะฝะฐัะตะฝะฝะพะตยws22ยะธย80ยะฟะพััั*

-ยะยะพััััยะฟะพะผะตััะธััยัะบัะธะฝยัยัะพะดะตัะถะฐะฝะธะตะผยะธะทะผะตะฝัะฝะฝะพะณะพยัะฐะนะปะฐ.

##### ะะฐะฟััะบะฐััยัะฐะนะปยัะฐะบะถะต,ยะบะฐะบยะฒยะงะฐััะธย4

*ะะตัะตะดยัะตััะธัะพะฒะฐะฝะธะตะผยัะตะบะพะผะตะฝะดัะตัััยะพัะบะปััะธััยัะตัะตะฒะพะนยะธะฝัะตััะตะนัย**NAT**ย(ะตะณะพยะฝะฐะปะธัะธะตยะผะพะถะฝะพยะฟัะพะฒะตัะธััยะบะพะผะฐะฝะดะพะนย`ipยa`)ยะฒยVirtualBox,ยะตัะปะธยะพะฝยะฒะบะปััะตะฝ*

- **SNAT**ย-ย*Source Network Address Translation*ย- ะธะทะผะตะฝะตะฝะธะต ะฐะดัะตัะฐ ะธ ะฟะพััะฐ ะธััะพัะฝะธะบะฐ ะฟะฐะบะตัะฐ, ะดะพัััะฟะตะฝ ะฒ ัะตะฟะพัะบะต POSTROUTING
- **DNAT**ย-ย*Destination Network Address Translation*ย- ะธะทะผะตะฝะตะฝะธะต ะฐะดัะตัะฐ ะธ ะฟะพััะฐ ะฝะฐะทะฝะฐัะตะฝะธั ะฟะฐะบะตัะฐ, ะดะพัััะฟะตะฝ ะฒ ัะตะฟะพัะบะฐั PREROUTING ะธ OUTPUT

##### ะัะพะฒะตัะธััยัะพะตะดะธะฝะตะฝะธะตยะฟะพยTCPยะดะปัย**SNAT**,ยะดะปัยััะพะณะพยัยws22ยะฟะพะดะบะปััะธััััยะบยัะตัะฒะตััยApacheยะฝะฐยr1ยะบะพะผะฐะฝะดะพะน:

`telnetย[ะฐะดัะตั]ย[ะฟะพัั]`

##### ะัะพะฒะตัะธััยัะพะตะดะธะฝะตะฝะธะตยะฟะพยTCPยะดะปัย**DNAT**,ยะดะปัยััะพะณะพยัยr1ยะฟะพะดะบะปััะธััััยะบยัะตัะฒะตััยApacheยะฝะฐยws22ยะบะพะผะฐะฝะดะพะนย`telnet`ย(ะพะฑัะฐัะฐััััยะฟะพยะฐะดัะตััยr2ยะธยะฟะพัััย8080)

-ยะยะพััััยะฟะพะผะตััะธััยัะบัะธะฝัยัยะฒัะทะพะฒะพะผยะธยะฒัะฒะพะดะพะผยะธัะฟะพะปัะทะพะฒะฐะฝะฝััยะบะพะผะฐะฝะด.

##### ะกะพััะฐะฝะธััยะดะฐะผะฟัยะพะฑัะฐะทะพะฒยะฒะธัััะฐะปัะฝััยะผะฐัะธะฝ

## Partย8.ยะะพะฟะพะปะฝะธัะตะปัะฝะพ.ยะะฝะฐะบะพะผััะฒะพยัย**SSHยTunnels**

`-`ยะะพะถะฐะปัะน,ยะฝะฐยััะพะผยัยะผะตะฝัยะฒัั.ยะะพะถะตัยัยัะตะฑัยะฟะพัะฒะธะปะธััยะตััยะบะฐะบะธะต-ัะพยะฒะพะฟัะพัั?

`-`ยะะฐ,ยัยัะพัะตะปยัะฟัะพัะธััยะตััยะพะฑยะพะดะฝะพะนยะฒะตัะธ.ยะะฐยัะฐะฑะพัะตยัยะบัะฐะตะผยััะฐยััะปััะฐะป,ยััะพยะฒยะผะพะตะนยะบะพะผะฟะฐะฝะธะธยะตัััยะฝะตะบะธะตยะฟัะพะตะบััยะฟะพยะพะฑััะตะฝะธั.ยะะพะดัะพะฑะฝะพััะตะนยัยะฝะตยะทะฝะฐั,ยะฝะพยะพัะตะฝัยัะพัะตัััยะฒะทะณะปัะฝััั...ยะะดััะณยะฑัะดะตัยะฟะพะปะตะทะฝะพ

`-`ยะะตะนััะฒะธัะตะปัะฝะพยะธะฝัะตัะตัะฝะพ,ยะฝะพยะบะฐะบยะฒยััะพะผยะฟะพะผะพะณัยัะตะฑะตยั?

`-`ยะะตะปะพยะฒยัะพะผ,ยััะพ,ยััะพะฑัยะดะพะฑัะฐััััยะดะพยััะธัยะฟัะพะตะบัะพะฒ,ยะฝัะถะฝะพยะฟะพะปััะธััยะดะพัััะฟยะบยะทะฐะบัััะพะนยัะตัะธ.ยะะพะถะตััยะฟะพัะพะฒะตัะพะฒะฐััยััะพ-ะฝะธะฑัะดัยะฟะพยััะพะผัยะฟะพะฒะพะดั?

`-`ยะัยัั,ยะบะพะฝะตัะฝะพ,ยะดะฐััั...ยะะตยัะฒะตัะตะฝยะฝะฐยะฒัะตยััะพ,ยััะพยััะพยะฟะพะผะพะถะตั,ยะฝะพยะผะพะณัยัะฐััะบะฐะทะฐััยัะตะฑะตยะฟัะพย**SSHยTunnels**.

**==ยะะฐะดะฐะฝะธะตย==**

*ะยะดะฐะฝะฝะพะผยะทะฐะดะฐะฝะธะธยะธัะฟะพะปัะทัััััยะฒะธัััะฐะปัะฝัะตยะผะฐัะธะฝัยะธะทยะงะฐััะธย5*

##### ะะฐะฟัััะธััยะฒะตะฑ-ัะตัะฒะตัย**Apache**ยะฝะฐยws22ยัะพะปัะบะพยะฝะฐยlocalhostย(ัะพยะตัััยะฝะตยะธะทะผะตะฝัััยัะฐะนะปย*/etc/apache2/ports.conf*ยะธะปะธ,ยะตัะปะธยะฑัะปยะธะทะผะตะฝะตะฝยัะฐะฝะตะต,ยะฒะตัะฝัััยัััะพะบัย`Listenย80`)

##### ะะพัะฟะพะปัะทะพะฒะฐััััย*LocalยTCPยforwarding*ยัยws21ยะดะพยws22,ยััะพะฑัยะฟะพะปััะธััยะดะพัััะฟยะบยะฒะตะฑ-ัะตัะฒะตััยะฝะฐยws22ยัยws21

##### ะะพัะฟะพะปัะทะพะฒะฐััััย*RemoteยTCPยforwarding*ยcยws11ยะดะพยws22,ยััะพะฑัยะฟะพะปััะธััยะดะพัััะฟยะบยะฒะตะฑ-ัะตัะฒะตััยะฝะฐยws22ยัยws11

##### ะะปัยะฟัะพะฒะตัะบะธ,ยััะฐะฑะพัะฐะปะพยะปะธยะฟะพะดะบะปััะตะฝะธะตยะฒยะพะฑะพะธัยะฟัะตะดัะดััะธัยะฟัะฝะบัะฐั,ยะฟะตัะตะนะดะธัะตยะฒะพยะฒัะพัะพะนยัะตัะผะธะฝะฐะปย(ะฝะฐะฟัะธะผะตั,ยะบะปะฐะฒะธัะฐะผะธยAltย+ยF2)ยะธยะฒัะฟะพะปะฝะธัะตยะบะพะผะฐะฝะดั:

`telnetย127.0.0.1ย[ะปะพะบะฐะปัะฝัะนยะฟะพัั]`

-ยะยะพััััะตยะพะฟะธัะฐััยะบะพะผะฐะฝะดั,ยะฝะตะพะฑัะพะดะธะผัะตยะดะปัยะฒัะฟะพะปะฝะตะฝะธัยััะธัยัะตัััััยะฟัะฝะบัะพะฒ,ยะฐยัะฐะบะถะตยะฟัะธะปะพะถะธััยัะบัะธะฝัะพััยัยะธัยะฒัะทะพะฒะพะผยะธยะฒัะฒะพะดะพะผ.

##### ะกะพััะฐะฝะธััยะดะฐะผะฟัยะพะฑัะฐะทะพะฒยะฒะธัััะฐะปัะฝััยะผะฐัะธะฝ
